<div id="chatbot-container" class="chatbot-container">
    <div id="chatbot-icon" class="chatbot-icon" onclick="toggleChat()">
        <i class="fas fa-comments"></i>
    </div>
    <div id="chatbot-window" class="chatbot-window">
        <div class="chatbot-header">
                        <h6>ExamMate & NotesMaker AI Assistant</h6>
            <button class="btn-close" onclick="toggleChat()"></button>
        </div>
        <div id="chatbot-messages" class="chatbot-messages">
            <div class="message bot-message">
                <div class="message-bubble">
                    <p>Hello! I'm your ExamMate & NotesMaker AI assistant. How can I help you today?</p>
                </div>
            </div>
        </div>
        <div class="chatbot-input">
            <input type="text" id="chatbot-input" placeholder="Type your message..." onkeypress="handleKeyPress(event)">
            <button onclick="sendMessage()" class="btn btn-primary">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>
</div>

<style>
    .chatbot-container {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 1000;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    .chatbot-icon {
        width: 60px;
        height: 60px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        cursor: pointer;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        transition: all 0.3s ease;
        animation: pulse 2s infinite;
    }
    
    .chatbot-icon:hover {
        transform: scale(1.1);
        box-shadow: 0 6px 20px rgba(0,0,0,0.3);
    }
    
    .chatbot-window {
        position: absolute;
        bottom: 80px;
        right: 0;
        width: 350px;
        height: 450px;
        background: white;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        display: none;
        flex-direction: column;
        overflow: hidden;
        border: 1px solid #e9ecef;
    }
    
    .chatbot-window.active {
        display: flex;
    }
    
    .chatbot-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .chatbot-header h6 {
        margin: 0;
        font-size: 14px;
        font-weight: 600;
    }
    
    .btn-close {
        background: none;
        border: none;
        color: white;
        font-size: 18px;
        cursor: pointer;
    }
    
    .chatbot-messages {
        flex: 1;
        padding: 20px;
        overflow-y: auto;
        background: #f8f9fa;
    }
    
    .message {
        margin-bottom: 15px;
        display: flex;
    }
    
    .message.bot-message {
        justify-content: flex-start;
    }
    
    .message.user-message {
        justify-content: flex-end;
    }
    
    .message-bubble {
        max-width: 80%;
        padding: 12px 16px;
        border-radius: 18px;
        font-size: 14px;
        line-height: 1.4;
    }
    
    .bot-message .message-bubble {
        background: white;
        border: 1px solid #e9ecef;
        border-bottom-left-radius: 4px;
    }
    
    .user-message .message-bubble {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-bottom-right-radius: 4px;
    }
    
    .chatbot-input {
        padding: 15px;
        background: white;
        border-top: 1px solid #e9ecef;
        display: flex;
        gap: 10px;
    }
    
    .chatbot-input input {
        flex: 1;
        padding: 12px 16px;
        border: 1px solid #e9ecef;
        border-radius: 25px;
        outline: none;
        font-size: 14px;
    }
    
    .chatbot-input input:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    .chatbot-input button {
        border: none;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 50%;
        width: 45px;
        height: 45px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .chatbot-input button:hover {
        transform: scale(1.05);
    }
    
    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
    }
    
    @media (max-width: 480px) {
        .chatbot-window {
            width: 300px;
            height: 400px;
        }
        
        .message-bubble {
            max-width: 90%;
        }
    }
</style>

<script>
    let isChatOpen = false;
    
    function toggleChat() {
        const window = document.getElementById('chatbot-window');
        isChatOpen = !isChatOpen;
        
        if (isChatOpen) {
            window.classList.add('active');
            // Focus on input when opening
            setTimeout(() => {
                document.getElementById('chatbot-input').focus();
            }, 300);
        } else {
            window.classList.remove('active');
        }
    }
    
    function sendMessage() {
        const input = document.getElementById('chatbot-input');
        const message = input.value.trim();
        
        if (message === '') return;
        
        // Add user message
        addMessage(message, 'user');
        input.value = '';
        
        // Simulate bot response
        setTimeout(() => {
            const response = getBotResponse(message);
            addMessage(response, 'bot');
        }, 1000);
    }
    
    function handleKeyPress(event) {
        if (event.key === 'Enter') {
            sendMessage();
        }
    }
    
    function addMessage(text, sender) {
        const messagesContainer = document.getElementById('chatbot-messages');
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${sender}-message`;
        
        const bubble = document.createElement('div');
        bubble.className = 'message-bubble';
        bubble.textContent = text;
        
        messageDiv.appendChild(bubble);
        messagesContainer.appendChild(messageDiv);
        
        // Scroll to bottom
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }
    
    // function getBotResponse(message) {
    //     const lowerMessage = message.toLowerCase();
        
    //     if (lowerMessage.includes('hello') || lowerMessage.includes('hi')) {
    //         return "Hello! Welcome to ExamMate & NotesMaker. How can I help you with your studies today? Content is managed by Admin PK.Hindustani.";
    //     }
        
    //     if (lowerMessage.includes('notes') || lowerMessage.includes('study')) {
    //         return "We offer both typed expert notes and beautiful handwritten notes, all managed by Admin PK.Hindustani. Content is currently being uploaded and will be available soon. Please check back later or contact admin for updates.";
    //     }
        
    //     if (lowerMessage.includes('handwritten') || lowerMessage.includes('handwriting')) {
    //         return "Handwritten notes provide a personal touch and are easier to study from. They are managed by Admin PK.Hindustani and will be available soon. Check the Handwritten Notes section!";
    //     }
        
    //     if (lowerMessage.includes('pyq') || lowerMessage.includes('question') || lowerMessage.includes('paper')) {
    //         return "Previous Year Questions are managed by Admin PK.Hindustani. Content is currently being uploaded and will be available soon. Please check back later or contact admin for updates.";
    //     }
        
    //     if (lowerMessage.includes('video') || lowerMessage.includes('solution')) {
    //         return "Video solutions are managed by Admin PK.Hindustani. Content is currently being uploaded and will be available soon. Please check back later or contact admin for updates.";
    //     }
        
    //     if (lowerMessage.includes('upload') || lowerMessage.includes('submit')) {
    //         return "Students can upload content through the Upload page, but all uploads require admin approval from PK.Hindustani before being published. This ensures quality content for everyone!";
    //     }
        
    //     if (lowerMessage.includes('admin') || lowerMessage.includes('pk')) {
    //         return "PK.Hindustani is the admin who manages all content on ExamMate & NotesMaker. Admin login is available at /admin/login for authorized users only.";
    //     }
        
    //     if (lowerMessage.includes('help') || lowerMessage.includes('support')) {
    //         return "I'm here to help! You can:\n\n1. Ask about notes, handwritten notes, PYQs, or videos\n2. Learn about uploading content\n3. Get help with navigation\n4. Contact Admin PK.Hindustani via WhatsApp at +91 8882767568";
    //     }
        
    //     if (lowerMessage.includes('thank')) {
    //         return "You're welcome! If you need any more help, just ask. Happy studying! ðŸ“š";
    //     }
        
    //     if (lowerMessage.includes('bye') || lowerMessage.includes('goodbye')) {
    //         return "Goodbye! Don't forget to study hard and visit us again for more educational resources!";
    //     }
        
    //     return "I'm still learning! For now, I can help you with:\n\nâ€¢ Finding notes and handwritten notes\nâ€¢ Understanding our PYQ system\nâ€¢ Learning about video solutions\nâ€¢ Uploading content process\nâ€¢ Admin information\n\nOr you can contact Admin PK.Hindustani at +91 8882767568";
    // }
    
    // // Close chat when clicking outside
    // document.addEventListener('click', function(event) {
    //     const chatbotContainer = document.getElementById('chatbot-container');
    //     const chatbotWindow = document.getElementById('chatbot-window');
        
    //     if (isChatOpen && !chatbotContainer.contains(event.target)) {
    //         // Don't close if clicking inside the window
    //         if (!chatbotWindow.contains(event.target)) {
    //             toggleChat();
    //         }
    //     }
    // });


    function normalize(text) {
    return text
        .toLowerCase()
        .replace(/[^\w\s]/g, '')
        .replace(/\s+/g, ' ')
        .trim();
}

const INTENTS = [
    {
        name: "greeting",
        keywords: ["hi", "hello", "hey", "good morning", "good evening"],
        response: "Hello! ðŸ‘‹ Iâ€™m your ExamMate & NotesMaker assistant. How can I help you today?"
    },
    {
        name: "notes",
        keywords: ["notes", "study material", "pdf", "typed notes", "class notes"],
        response: "We provide **high-quality typed notes and handwritten notes**, curated and approved by Admin PK.Hindustani. You can explore them in the Notes section."
    },
    {
        name: "handwritten_notes",
        keywords: ["handwritten", "handwriting", "written notes"],
        response: "Handwritten notes are designed to be exam-friendly and easy to revise. You can find them in the **Handwritten Notes** section once published."
    },
    {
        name: "pyqs",
        keywords: ["pyq", "previous year", "question paper", "old papers"],
        response: "Previous Year Question Papers (PYQs) are uploaded subject-wise and year-wise. Check the **PYQs** section for available content."
    },
    {
        name: "videos",
        keywords: ["video", "lecture", "solution", "explanation"],
        response: "Video explanations are added to help you understand concepts visually. Visit the **Videos** section for learning resources."
    },
    {
        name: "upload",
        keywords: ["upload", "submit", "contribute"],
        response: "You can upload study material from the **Upload** page. All submissions are reviewed and approved by Admin PK.Hindustani."
    },
    {
        name: "order",
        keywords: ["order", "buy", "purchase"],
        response: "You can place an order for notes directly from the **Order** page. Once submitted, our team will contact you."
    },
    {
        name: "admin",
        keywords: ["admin", "pk", "owner"],
        response: "All content on ExamMate & NotesMaker is managed by **PK.Hindustani** to ensure accuracy and quality."
    },
    {
        name: "help",
        keywords: ["help", "support", "assist"],
        response: "I can help you with:\nâ€¢ Notes & Handwritten Notes\nâ€¢ PYQs\nâ€¢ Video Solutions\nâ€¢ Uploading content\nâ€¢ Orders\n\nJust ask!"
    },
    {
        name: "thanks",
        keywords: ["thank", "thanks"],
        response: "Youâ€™re welcome! ðŸ˜Š Happy studying!"
    },
    {
        name: "bye",
        keywords: ["bye", "goodbye", "see you"],
        response: "Goodbye! ðŸ“š Come back anytime for more study resources."
    }
];

function detectIntent(message) {
    let bestMatch = null;
    let highestScore = 0;

    for (const intent of INTENTS) {
        let score = 0;
        for (const keyword of intent.keywords) {
            if (message.includes(keyword)) {
                score++;
            }
        }
        if (score > highestScore) {
            highestScore = score;
            bestMatch = intent;
        }
    }

    return bestMatch;
}

function getBotResponse(message) {
    const cleanMessage = normalize(message);
    const intent = detectIntent(cleanMessage);

    if (intent) {
        return intent.response;
    }

    return (
        "I want to give you the **most accurate answer**.\n\n" +
        "You can ask me about:\n" +
        "â€¢ Notes & Handwritten Notes\n" +
        "â€¢ PYQs\n" +
        "â€¢ Videos\n" +
        "â€¢ Orders\n" +
        "â€¢ Uploading content\n\n" +
        "Or contact Admin PK.Hindustani for direct help."
    );
}
</script>
